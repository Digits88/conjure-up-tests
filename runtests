#!/bin/bash

set -eu

. ./common.sh

sudo snap install conjure-up --classic --edge || true

export JUJU_MODEL=conjure-up-test
export JUJU_CONTROLLER=conjure-up-controller

spells=(ghost \
            kubernetes-core \
            canonical-kubernetes \
            hadoop-kafka \
            hadoop-processing \
            hadoop-spark \
            realtime-syslog-analytics \
            spark-processing \
            openstack-novalxd)

for spell in ${spells[@]}; do
    conjure-up $spell localhost $JUJU_CONTROLLER $JUJU_MODEL
    if [ -f $spell.verify ]; then
        log "Verifying deployment of $spell"
        ./$spell.verify
    fi
    conjure-down $JUJU_CONTROLLER $JUJU_MODEL
    sleep 10
done
exit 0

juju kill-controller -y $JUJU_CONTROLLER
